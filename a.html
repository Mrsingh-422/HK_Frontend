<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cascading Dropdown Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: auto;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            /* Padding inside the width */
        }

        .loading-text {
            color: orange;
            font-style: italic;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Dependent Location Selector</h1>

        <!-- Country Dropdown -->
        <label for="countrySelect">Select Country:</label>
        <select id="countrySelect">
            <option value="">Loading Countries...</option>
        </select>

        <!-- State Dropdown -->
        <label for="stateSelect">Select State:</label>
        <select id="stateSelect" disabled>
            <option value="">Please select a country first</option>
        </select>

        <!-- City Dropdown -->
        <label for="citySelect">Select City:</label>
        <select id="citySelect" disabled>
            <option value="">Please select a state first</option>
        </select>

        <p id="statusMessage"></p>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3001/api';

        // DOM Elements
        const countrySelect = document.getElementById('countrySelect');
        const stateSelect = document.getElementById('stateSelect');
        const citySelect = document.getElementById('citySelect');
        const statusMessage = document.getElementById('statusMessage');

        // --- API Fetch Functions ---

        /**
         * Generic function to fetch data from an endpoint and populate a select element.
         * @param {string} endpoint - The API endpoint (e.g., 'countries', 'states')
         * @param {string} selectElementId - The ID of the <select> element to populate
         * @param {string} defaultText - The text for the initial/default option
         * @param {string | null} filterParam - Optional query parameter for filtering (e.g., { key: 'country_id', value: '101' })
         */
        async function fetchDataAndPopulate(endpoint, selectElementId, defaultText, filterParam = null) {
            const selectElement = document.getElementById(selectElementId);
            selectElement.innerHTML = `<option value="" class="loading-text">${defaultText}</option>`;
            selectElement.disabled = true;
            statusMessage.textContent = `Fetching ${endpoint}...`;

            let url = `${API_BASE_URL}/${endpoint}`;
            if (filterParam && filterParam.value) {
                url += `?${filterParam.key}=${filterParam.value}`;
            }

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();

                // Clear loading option and add actual options
                selectElement.innerHTML = `<option value="">-- Select ${endpoint.charAt(0).toUpperCase() + endpoint.slice(0, -1)} --</option>`;

                if (data.length === 0) {
                    selectElement.innerHTML = `<option value="">No options available</option>`;
                    statusMessage.textContent = `No ${endpoint} found for the selected criteria.`;
                    return;
                }

                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id; // Use ID as value
                    option.textContent = item.name; // Use Name as text
                    selectElement.appendChild(option);
                });

                selectElement.disabled = false;
                statusMessage.textContent = `Successfully loaded ${data.length} ${endpoint}.`;

            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                selectElement.innerHTML = `<option value="">Error loading data</option>`;
                statusMessage.textContent = `Error loading ${endpoint}: ${error.message}`;
            }
        }

        // --- Event Listeners and Initial Load ---

        // 1. Load Countries on Page Load
        window.onload = () => {
            fetchDataAndPopulate('countries', 'countrySelect', 'Loading Countries...');
        };

        // 2. Handle Country Change -> Load States
        countrySelect.addEventListener('change', function () {
            const selectedCountryId = this.value;

            // Reset subsequent dropdowns
            stateSelect.innerHTML = '<option value="">-- Select State --</option>';
            stateSelect.disabled = true;
            citySelect.innerHTML = '<option value="">-- Select City --</option>';
            citySelect.disabled = true;

            if (selectedCountryId) {
                fetchDataAndPopulate(
                    'states',
                    'stateSelect',
                    'Loading States...',
                    { key: 'country_id', value: selectedCountryId }
                );
            }
        });

        // 3. Handle State Change -> Load Cities
        stateSelect.addEventListener('change', function () {
            const selectedStateId = this.value;

            // Reset City dropdown
            citySelect.innerHTML = '<option value="">-- Select City --</option>';
            citySelect.disabled = true;

            if (selectedStateId) {
                fetchDataAndPopulate(
                    'cities',
                    'citySelect',
                    'Loading Cities...',
                    { key: 'state_id', value: selectedStateId }
                );
            }
        });

    </script>

</body>

</html>